# ğŸª Team-FOG User Service

## ğŸ“‹ ê°œìš”

Team-FOG í”„ë¡œì íŠ¸ì˜ **User Service**ëŠ” ì‚¬ìš©ì ì¸ì¦, íšŒì›ê°€ì…, ë§ˆì´í˜ì´ì§€ ê¸°ëŠ¥ì„ ë‹´ë‹¹í•˜ëŠ” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.

- **ë‹´ë‹¹ì**: User Service ë‹´ë‹¹ì
- **í¬íŠ¸**: 8082
- **ê¸°ìˆ  ìŠ¤íƒ**: Spring Boot 3.4.0, Java 21, H2/Oracle DB (PDB + Standby), AWS Cognito
- **ì¸ì¦ ë°©ì‹**: AWS Cognito JWT í† í° ê¸°ë°˜

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1. ê°œë°œ í™˜ê²½ ì„¤ì •

```bash
# í”„ë¡œì íŠ¸ í´ë¡ 
git clone https://github.com/Jay-yoons/Team-FOG.git
cd Team-FOG

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
./gradlew bootRun
```

### 2. API í…ŒìŠ¤íŠ¸

REST Client í™•ì¥í”„ë¡œê·¸ë¨ì„ ì‚¬ìš©í•˜ì—¬ `api-tests-with-token.http` íŒŒì¼ë¡œ APIë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
# ë”ë¯¸ ë¡œê·¸ì¸ìœ¼ë¡œ í† í° ë°›ê¸°
curl -X GET "http://localhost:8082/api/users/login/dummy?state=test-state"

# í† í°ìœ¼ë¡œ API í˜¸ì¶œ
curl -H "Authorization: Bearer YOUR_TOKEN" http://localhost:8082/api/users/me
```

## ğŸ” ì¸ì¦ ì‹œìŠ¤í…œ

### AWS Cognito ì„¤ì •

í˜„ì¬ **ë”ë¯¸ ëª¨ë“œ**ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´ ì‹¤ì œ AWS Cognito ì—†ì´ë„ ê°œë°œ ë° í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

```yaml
# application.yml
aws:
  cognito:
    dummy-mode: true  # ê°œë°œìš© ë”ë¯¸ ëª¨ë“œ
```

### ì‹¤ì œ ì„œë¹„ìŠ¤ ì „í™˜ ì‹œ

```yaml
aws:
  cognito:
    dummy-mode: false  # ì‹¤ì œ Cognito ì‚¬ìš©
    user-pool-id: ${COGNITO_USER_POOL_ID}
    client-id: ${COGNITO_CLIENT_ID}
    client-secret: ${COGNITO_CLIENT_SECRET}
```

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### Users í…Œì´ë¸” (Oracle PDB)
```sql
-- PDB: TEAMFOG
CREATE TABLE users (
    user_id VARCHAR2(15) PRIMARY KEY,
    user_name VARCHAR2(20) NOT NULL,
    phone_number VARCHAR2(20) UNIQUE NOT NULL,
    user_location VARCHAR2(50),
    password VARCHAR2(255) NOT NULL,
    is_active NUMBER(1) DEFAULT 1 NOT NULL,
    created_at TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL,
    updated_at TIMESTAMP
);
```

### Favorite Stores í…Œì´ë¸” (Oracle PDB)
```sql
-- PDB: TEAMFOG
CREATE TABLE mv_fav_store (
    fav_store_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id VARCHAR2(15) NOT NULL,
    store_id VARCHAR2(20) NOT NULL,
    created_at TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL,
    CONSTRAINT fav_store_un UNIQUE (user_id, store_id)
);
```

### ê°œë°œ í™˜ê²½ (H2 Database)
ê°œë°œ í™˜ê²½ì—ì„œëŠ” H2 ì¸ë©”ëª¨ë¦¬ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

### ìš´ì˜ í™˜ê²½ (Oracle PDB + Standby)
- **PrimaryDB**: ì“°ê¸° ì‘ì—… ë° ì½ê¸° ì‘ì—…
- **StandbyDB**: ì½ê¸° ì „ìš© ì‘ì—… (ë¦¬í¬ì§€ì…˜)

## ğŸ”Œ API ì—”ë“œí¬ì¸íŠ¸

### ì¸ì¦ ê´€ë ¨ API

| ë©”ì„œë“œ | ì—”ë“œí¬ì¸íŠ¸ | ì„¤ëª… | ì¸ì¦ í•„ìš” |
|--------|------------|------|-----------|
| GET | `/api/users/login/url` | Cognito ë¡œê·¸ì¸ URL ìƒì„± | âŒ |
| GET | `/api/users/login/dummy` | ë”ë¯¸ ë¡œê·¸ì¸ (ê°œë°œìš©) | âŒ |
| POST | `/api/users/login/callback` | Cognito ì½œë°± ì²˜ë¦¬ | âŒ |
| POST | `/api/users/logout` | ë¡œê·¸ì•„ì›ƒ | âœ… |

### ì‚¬ìš©ì ê´€ë¦¬ API

| ë©”ì„œë“œ | ì—”ë“œí¬ì¸íŠ¸ | ì„¤ëª… | ì¸ì¦ í•„ìš” |
|--------|------------|------|-----------|
| POST | `/api/users` | íšŒì›ê°€ì… | âŒ |
| GET | `/api/users/me` | ë‚´ ì •ë³´ ì¡°íšŒ | âœ… |
| PUT | `/api/users/me` | ì‚¬ìš©ì ì •ë³´ ìˆ˜ì • | âœ… |
| GET | `/api/users/count` | ì „ì²´ ì‚¬ìš©ì ìˆ˜ ì¡°íšŒ | âŒ |

### ë§ˆì´í˜ì´ì§€ API

| ë©”ì„œë“œ | ì—”ë“œí¬ì¸íŠ¸ | ì„¤ëª… | ì¸ì¦ í•„ìš” |
|--------|------------|------|-----------|
| GET | `/api/users/me/reviews` | ë‚´ê°€ ì‘ì„±í•œ ë¦¬ë·° ëª©ë¡ | âœ… |
| GET | `/api/users/me/reviews/{reviewId}/store-info` | ë¦¬ë·° ê´€ë ¨ ê°€ê²Œ ì •ë³´ | âœ… |
| GET | `/api/users/me/favorites` | ë‚´ ì¦ê²¨ì°¾ê¸° ê°€ê²Œ ëª©ë¡ | âœ… |
| POST | `/api/users/me/favorites` | ì¦ê²¨ì°¾ê¸° ê°€ê²Œ ì¶”ê°€ | âœ… |
| DELETE | `/api/users/me/favorites/{storeId}` | ì¦ê²¨ì°¾ê¸° ê°€ê²Œ ì‚­ì œ | âœ… |
| GET | `/api/users/me/favorites/{storeId}/check` | ì¦ê²¨ì°¾ê¸° ìƒíƒœ í™•ì¸ | âœ… |
| GET | `/api/users/me/favorites/count` | ì¦ê²¨ì°¾ê¸° ê°€ê²Œ ê°œìˆ˜ | âœ… |

### ê°œë°œìš© API

| ë©”ì„œë“œ | ì—”ë“œí¬ì¸íŠ¸ | ì„¤ëª… | ì¸ì¦ í•„ìš” |
|--------|------------|------|-----------|
| POST | `/api/users/dummy/data` | ë”ë¯¸ ë°ì´í„° ìƒì„± | âŒ |
| GET | `/api/users/health` | ì„œë¹„ìŠ¤ í—¬ìŠ¤ì²´í¬ | âŒ |

## ğŸ”„ MSA ì—°ë™

### Store Service ì—°ë™

User ServiceëŠ” Store Serviceì™€ ì—°ë™í•˜ì—¬ ë¦¬ë·° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

```java
// Store Serviceì—ì„œ ë¦¬ë·° ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
List<ReviewDto> reviews = storeServiceIntegration.getUserReviews(userId);

// Store Serviceì—ì„œ ê°€ê²Œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
Map<String, Object> storeInfo = storeServiceIntegration.getStoreInfoForReview(reviewId);
```

### ì„œë¹„ìŠ¤ URL ì„¤ì •

```yaml
# application.yml
msa:
  service-urls:
    store-service: http://localhost:8081  # Store Service URL
    reservation-service: http://localhost:8080  # Reservation Service URL
```

## ğŸ§ª í…ŒìŠ¤íŠ¸

### 1. ë”ë¯¸ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸

```bash
# ë”ë¯¸ ë¡œê·¸ì¸
curl -X GET "http://localhost:8082/api/users/login/dummy?state=test-state"
```

ì‘ë‹µ ì˜ˆì‹œ:
```json
{
  "success": true,
  "accessToken": "dummy-access-token-1234567890",
  "idToken": "dummy-id-token-1234567890",
  "refreshToken": "dummy-refresh-token-1234567890",
  "tokenType": "Bearer",
  "expiresIn": 3600,
  "userInfo": {
    "sub": "dummy4879",
    "name": "ë”ë¯¸ ì‚¬ìš©ì",
    "email": "dummy@example.com"
  },
  "message": "ë”ë¯¸ ë¡œê·¸ì¸ ì„±ê³µ"
}
```

### 2. ì¸ì¦ëœ API í…ŒìŠ¤íŠ¸

```bash
# ë‚´ ì •ë³´ ì¡°íšŒ
curl -H "Authorization: Bearer dummy-access-token-1234567890" \
  http://localhost:8082/api/users/me
```

ì‘ë‹µ ì˜ˆì‹œ:
```json
{
  "userId": "dummy4879",
  "userName": "ë”ë¯¸ ì‚¬ìš©ì",
  "phoneNumber": "010-1234-5678",
  "userLocation": "ì„œìš¸ì‹œ ê°•ë‚¨êµ¬",
  "createdAt": "2025-08-12T10:14:10.085936",
  "updatedAt": "2025-08-12T10:14:10.085936",
  "active": true
}
```

### 3. ë”ë¯¸ ë°ì´í„° ìƒì„±

```bash
# ë”ë¯¸ ì‚¬ìš©ì ë° ì¦ê²¨ì°¾ê¸° ë°ì´í„° ìƒì„±
curl -X POST http://localhost:8082/api/users/dummy/data
```

## ğŸ”§ ê°œë°œ í™˜ê²½

### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­

- Java 21
- Gradle 8.x
- H2 Database (ê°œë°œìš©)
- Oracle Database (í”„ë¡œë•ì…˜ìš©)

### ì£¼ìš” ì˜ì¡´ì„±

```gradle
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-security'
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'com.auth0:java-jwt:4.4.0'
    implementation 'software.amazon.awssdk:cognitoidentityprovider:2.21.0'
    implementation 'com.h2database:h2'  // ê°œë°œìš©
    implementation 'com.oracle.database.jdbc:ojdbc11:23.3.0.23.09'  // Oracle DB (í”„ë¡œë•ì…˜ìš©)
}
```

### í™˜ê²½ë³€ìˆ˜

```bash
# ê°œë°œ í™˜ê²½
SPRING_PROFILES_ACTIVE=dev

# í”„ë¡œë•ì…˜ í™˜ê²½
SPRING_PROFILES_ACTIVE=prod
COGNITO_USER_POOL_ID=ap-northeast-2_xxxxxxxxx
COGNITO_CLIENT_ID=xxxxxxxxxxxxxxxxxxxxxxxxxxx
COGNITO_CLIENT_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxx

# Oracle Database ì„¤ì • (PDB + Standby)
# PrimaryDB
ORACLE_HOST=primarydb.internal
ORACLE_PORT=1521
ORACLE_SERVICE_NAME=TEAMFOG
ORACLE_USERNAME=user_service
ORACLE_PASSWORD=xxxxxxxxxxxx

# StandbyDB (Read-Only)
ORACLE_STANDBY_HOST=standbydb.internal
ORACLE_STANDBY_PORT=1521
ORACLE_STANDBY_SERVICE_NAME=TEAMFOG
ORACLE_STANDBY_USERNAME=user_service_readonly
ORACLE_STANDBY_PASSWORD=xxxxxxxxxxxx
```

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
src/main/java/com/restaurant/reservation/
â”œâ”€â”€ UserServiceApplication.java          # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ UserController.java              # API ì»¨íŠ¸ë¡¤ëŸ¬
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ UserService.java                 # ì‚¬ìš©ì ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”œâ”€â”€ AwsCognitoService.java           # Cognito ì—°ë™ ì„œë¹„ìŠ¤
â”‚   â””â”€â”€ StoreServiceIntegration.java     # Store Service ì—°ë™
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ SecurityConfig.java              # Spring Security ì„¤ì •
â”‚   â”œâ”€â”€ AwsCognitoConfig.java            # Cognito ì„¤ì •
â”‚   â”œâ”€â”€ CognitoAuthenticationFilter.java # JWT ì¸ì¦ í•„í„°
â”‚   â””â”€â”€ MsaConfig.java                   # MSA ì„¤ì •
â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ User.java                        # ì‚¬ìš©ì ì—”í‹°í‹°
â”‚   â””â”€â”€ FavoriteStore.java               # ì¦ê²¨ì°¾ê¸° ì—”í‹°í‹°
â”œâ”€â”€ repository/
â”‚   â”œâ”€â”€ UserRepository.java              # ì‚¬ìš©ì ë¦¬í¬ì§€í† ë¦¬
â”‚   â””â”€â”€ FavoriteStoreRepository.java     # ì¦ê²¨ì°¾ê¸° ë¦¬í¬ì§€í† ë¦¬
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ UserInfoDto.java                 # ì‚¬ìš©ì ì •ë³´ DTO
â”‚   â”œâ”€â”€ ReviewDto.java                   # ë¦¬ë·° DTO
â”‚   â””â”€â”€ FavoriteStoreDto.java            # ì¦ê²¨ì°¾ê¸° DTO
â””â”€â”€ exception/
    â”œâ”€â”€ ServiceConnectionException.java   # ì„œë¹„ìŠ¤ ì—°ê²° ì˜ˆì™¸
    â””â”€â”€ ServiceHttpException.java         # HTTP ì˜ˆì™¸
```

## ğŸš¨ ë¬¸ì œ í•´ê²°

### 1. í¬íŠ¸ ì¶©ëŒ

```bash
# 8082 í¬íŠ¸ ì‚¬ìš© ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ í™•ì¸
netstat -ano | findstr :8082

# í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
taskkill /f /im java.exe
```

### 2. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨

```bash
# H2 ì½˜ì†” ì ‘ì† (ê°œë°œìš©)
http://localhost:8082/h2-console
JDBC URL: jdbc:h2:mem:userdb
Username: sa
Password: (ë¹„ì–´ìˆìŒ)
```

### 3. ì¸ì¦ ì‹¤íŒ¨

- í† í°ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
- í† í° ë§Œë£Œ ì‹œê°„ í™•ì¸
- Authorization í—¤ë” í˜•ì‹ í™•ì¸: `Bearer YOUR_TOKEN`

## ğŸ“ ì—°ë½ì²˜

- **ë‹´ë‹¹ì**: User Service ë‹´ë‹¹ì
- **ì´ë©”ì¼**: user-service@team-fog.com
- **ìŠ¬ë™**: #user-service

## ğŸ“š ì¶”ê°€ ë¬¸ì„œ

- [ë°°í¬ ê°€ì´ë“œ](docs/DEPLOYMENT_GUIDE.md) - AWS ECS ë°°í¬ ë°©ë²•
- [API ë¬¸ì„œ](docs/API_DOCUMENTATION.md) - ìƒì„¸ API ëª…ì„¸
- [MSA ì—°ë™ ê°€ì´ë“œ](docs/MSA_INTEGRATION.md) - ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì™€ì˜ ì—°ë™ ë°©ë²•
