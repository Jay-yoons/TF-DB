<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>레스토랑 예약 시스템</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 80px 0;
        }
        .feature-card {
            transition: transform 0.3s ease;
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }
        .btn-custom {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
        }
        .btn-custom:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            color: white;
            transform: translateY(-2px);
        }
        .map-container {
            height: 400px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .restaurant-list {
            max-height: 300px;
            overflow-y: auto;
        }
        .restaurant-item {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .restaurant-item:hover {
            background-color: #f8f9fa;
        }
        .footer {
            background-color: #343a40;
            color: white;
            padding: 40px 0 20px;
        }
        .restaurant-info-item {
            display: flex;
            align-items: center;
            font-size: 14px;
        }
        .modal-content {
            border-radius: 15px;
            border: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0;
        }
        .modal-title {
            font-weight: 600;
        }
        .btn-close {
            filter: invert(1);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-utensils me-2"></i>레스토랑 예약 시스템
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/restaurants">레스토랑</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/mypage" id="mypageLink" style="display: none;">마이페이지</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/login-page" id="loginLink">로그인</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/signup" id="signupLink">회원가입</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/logout-page" id="logoutLink" style="display: none;">로그아웃</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container text-center">
            <h1 class="display-4 fw-bold mb-4">최고의 레스토랑 예약 경험</h1>
            <p class="lead mb-5">원하는 레스토랑을 쉽고 편리하게 예약하세요</p>
            <div class="d-flex justify-content-center gap-3">
                <a href="/restaurants" class="btn btn-custom btn-lg">
                    <i class="fas fa-search me-2"></i>레스토랑 찾기
                </a>
                                 <a href="/reservations" class="btn btn-outline-light btn-lg">
                     <i class="fas fa-calendar-check me-2"></i>예약 관리
                 </a>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="py-5">
        <div class="container">
            <div class="row text-center mb-5">
                <div class="col-12">
                    <h2 class="fw-bold">주요 기능</h2>
                    <p class="text-muted">편리하고 안전한 예약 시스템을 경험해보세요</p>
                </div>
            </div>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card feature-card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-search fa-3x text-primary mb-3"></i>
                            <h5 class="card-title">레스토랑 검색</h5>
                            <p class="card-text">위치, 음식 종류, 평점 등 다양한 조건으로 원하는 레스토랑을 찾아보세요.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card feature-card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-calendar-plus fa-3x text-success mb-3"></i>
                            <h5 class="card-title">간편한 예약</h5>
                            <p class="card-text">몇 번의 클릭만으로 원하는 시간에 레스토랑을 예약할 수 있습니다.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card feature-card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-bell fa-3x text-warning mb-3"></i>
                            <h5 class="card-title">실시간 알림</h5>
                            <p class="card-text">예약 확인, 변경, 취소 등 모든 상황을 실시간으로 알려드립니다.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Google Maps Section -->
    <section class="py-5 bg-light">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <h2 class="text-center mb-5">
                        <i class="fas fa-map-marker-alt text-primary me-2"></i>
                        주변 레스토랑 찾기
                    </h2>
                </div>
            </div>
            <div class="row">
                <div class="col-md-8">
                    <div class="map-container" id="map"></div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-list text-secondary me-2"></i>
                                주변 레스토랑
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="restaurant-list" id="nearbyRestaurants">
                                <!-- 주변 레스토랑 목록이 여기에 동적으로 로드됩니다 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5><i class="fas fa-utensils me-2"></i>레스토랑 예약 시스템</h5>
                    <p class="text-muted">최고의 레스토랑 예약 경험을 제공합니다.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <h6>연락처</h6>
                    <p class="text-muted">
                        <i class="fas fa-phone me-2"></i>02-1234-5678<br>
                        <i class="fas fa-envelope me-2"></i>info@restaurant-booking.com
                    </p>
                </div>
            </div>
            <hr class="my-4">
            <div class="text-center">
                <p class="text-muted mb-0">&copy; 2025 Team F.O.G. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- 예약 모달 -->
    <div class="modal fade" id="reservationModal" tabindex="-1" aria-labelledby="reservationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reservationModalLabel">
                        <i class="fas fa-utensils me-2"></i>레스토랑 예약
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="restaurant-details mb-4">
                                <h4 id="modalRestaurantName" class="text-primary mb-3"></h4>
                                <div class="restaurant-info-item mb-2">
                                    <i class="fas fa-map-marker-alt text-danger me-2"></i>
                                    <span id="modalRestaurantLocation"></span>
                                </div>
                                <div class="restaurant-info-item mb-2">
                                    <i class="fas fa-star text-warning me-2"></i>
                                    <span id="modalRestaurantRating"></span>
                                </div>
                                <div class="restaurant-info-item mb-3">
                                    <i class="fas fa-utensils text-success me-2"></i>
                                    <span id="modalRestaurantCuisine"></span>
                                </div>
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    예약을 위해 로그인이 필요합니다.
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <form id="reservationForm">
                                <div class="mb-3">
                                    <label for="reservationDate" class="form-label">
                                        <i class="fas fa-calendar me-2"></i>예약 날짜
                                    </label>
                                    <input type="date" class="form-control" id="reservationDate" required>
                                </div>
                                <div class="mb-3">
                                    <label for="reservationTime" class="form-label">
                                        <i class="fas fa-clock me-2"></i>예약 시간
                                    </label>
                                    <select class="form-control" id="reservationTime" required>
                                        <option value="">시간 선택</option>
                                        <option value="11:00">11:00</option>
                                        <option value="11:30">11:30</option>
                                        <option value="12:00">12:00</option>
                                        <option value="12:30">12:30</option>
                                        <option value="13:00">13:00</option>
                                        <option value="13:30">13:30</option>
                                        <option value="17:00">17:00</option>
                                        <option value="17:30">17:30</option>
                                        <option value="18:00">18:00</option>
                                        <option value="18:30">18:30</option>
                                        <option value="19:00">19:00</option>
                                        <option value="19:30">19:30</option>
                                        <option value="20:00">20:00</option>
                                        <option value="20:30">20:30</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="reservationGuests" class="form-label">
                                        <i class="fas fa-users me-2"></i>인원 수
                                    </label>
                                    <select class="form-control" id="reservationGuests" required>
                                        <option value="">인원 선택</option>
                                        <option value="1">1명</option>
                                        <option value="2">2명</option>
                                        <option value="3">3명</option>
                                        <option value="4">4명</option>
                                        <option value="5">5명</option>
                                        <option value="6">6명</option>
                                        <option value="7">7명</option>
                                        <option value="8">8명</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="reservationNotes" class="form-label">
                                        <i class="fas fa-sticky-note me-2"></i>특별 요청사항
                                    </label>
                                    <textarea class="form-control" id="reservationNotes" rows="3" placeholder="특별한 요청사항이 있으시면 입력해주세요."></textarea>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>취소
                    </button>
                    <button type="button" class="btn btn-primary" onclick="submitReservation()">
                        <i class="fas fa-calendar-check me-2"></i>예약하기
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCYvLE0Zd4kePqs66CTVtCpAfWTXU9uqVc&callback=initMap" async defer></script>
    <script>
        // 전역 변수
        let map;
        let markers = [];
        let restaurants = [];

                // 지도 초기화
        function initMap() {
            try {
                console.log('지도 초기화 시작...');
                
                // 강남역을 중심으로 설정
                const gangnam = { lat: 37.5172, lng: 127.0473 };
                
                const mapElement = document.getElementById('map');
                if (!mapElement) {
                    console.error('지도 컨테이너를 찾을 수 없습니다.');
                    return;
                }
                
                map = new google.maps.Map(mapElement, {
                    zoom: 15,
                    center: gangnam,
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                    styles: [
                        {
                            featureType: "poi",
                            elementType: "labels",
                            stylers: [{ visibility: "off" }]
                        }
                    ]
                });

                console.log('Google 지도 초기화 완료');
                
                // API에서 실제 레스토랑 데이터 로드
                setTimeout(() => {
                    loadRestaurantsFromAPI();
                }, 500); // 지도 로드 후 약간의 지연을 두고 데이터 로드
                
                console.log('Google 지도가 성공적으로 로드되었습니다.');
            } catch (error) {
                console.error('지도 로드 중 오류 발생:', error);
                showMapError();
            }
        }

        // 지도 오류 표시
        function showMapError() {
            const mapContainer = document.getElementById('map');
            if (mapContainer) {
                mapContainer.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: #666; background: #f8f9fa; border-radius: 10px;">
                        <i class="fas fa-map-marked-alt" style="font-size: 3rem; margin-bottom: 1rem; color: #ccc;"></i>
                        <h4>지도 로드 중...</h4>
                        <p>잠시만 기다려주세요.</p>
                        <button class="btn btn-primary btn-sm mt-3" onclick="retryMapLoad()">
                            <i class="fas fa-redo"></i> 다시 시도
                        </button>
                    </div>
                `;
            }
        }

        // 지도 다시 로드 시도
        function retryMapLoad() {
            console.log('지도 다시 로드 시도 중...');
            if (typeof google !== 'undefined' && google.maps) {
                initMap();
            } else {
                // Google Maps API가 로드되지 않은 경우 다시 로드
                const script = document.createElement('script');
                script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyCYvLE0Zd4kePqs66CTVtCpAfWTXU9uqVc&callback=initMap';
                script.async = true;
                script.defer = true;
                document.head.appendChild(script);
            }
        }

        // 샘플 레스토랑 데이터 로드
        function loadSampleRestaurants() {
            restaurants = [
                {
                    name: "강남 스테이크하우스",
                    location: "서울시 강남구 테헤란로 123",
                    lat: 37.5172,
                    lng: 127.0473,
                    rating: 4.5,
                    cuisine: "스테이크",
                    seatNum: 10
                },
                {
                    name: "강남 이탈리안 레스토랑",
                    location: "서울시 서초구 강남대로 456",
                    lat: 37.5180,
                    lng: 127.0480,
                    rating: 4.2,
                    cuisine: "이탈리안",
                    seatNum: 10
                },
                {
                    name: "송파 한식당",
                    location: "서울시 강남구 남강로 789",
                    lat: 37.5165,
                    lng: 127.0465,
                    rating: 4.7,
                    cuisine: "한식",
                    seatNum: 10
                },
                {
                    name: "마포 카페",
                    location: "서울시 강남구 솔데로 321",
                    lat: 37.5190,
                    lng: 127.0490,
                    rating: 4.3,
                    cuisine: "카페",
                    seatNum: 10
                },
                {
                    name: "영등포 중식당",
                    location: "서울시 강남구 강북로 654",
                    lat: 37.5155,
                    lng: 127.0455,
                    rating: 4.1,
                    cuisine: "중식",
                    seatNum: 10
                }
            ];

            loadRestaurantsOnMap();
            updateNearbyRestaurantsList();
        }

        // 지도에 레스토랑 마커 추가
        function loadRestaurantsOnMap() {
            if (!map) {
                console.error('지도가 초기화되지 않았습니다.');
                return;
            }

            // 기존 마커 제거
            markers.forEach(marker => marker.setMap(null));
            markers = [];

            restaurants.forEach(restaurant => {
                const marker = new google.maps.Marker({
                    position: { lat: restaurant.lat, lng: restaurant.lng },
                    map: map,
                    title: restaurant.name,
                    icon: {
                        url: 'https://maps.google.com/mapfiles/ms/icons/red-dot.png',
                        scaledSize: new google.maps.Size(32, 32)
                    }
                });

                // 정보창 추가
                const infowindow = new google.maps.InfoWindow({
                    content: `
                        <div style="padding: 15px; min-width: 250px;">
                            <h5 style="margin: 0 0 8px 0; color: #333; font-weight: 600;">${restaurant.name}</h5>
                            <p style="margin: 0 0 8px 0; color: #666; font-size: 12px;">
                                <i class="fas fa-map-marker-alt" style="color: #dc3545; margin-right: 5px;"></i>
                                ${restaurant.location}
                            </p>
                                                         <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                 <span style="color: #ffc107; font-size: 14px;">★</span>
                                 <span style="font-size: 12px; font-weight: 600;">${restaurant.rating.toFixed(1)}</span>
                                 <span style="background: #f0f0f0; padding: 3px 8px; border-radius: 12px; font-size: 10px; color: #666;">${restaurant.cuisine}</span>
                             </div>
                             <div style="margin-bottom: 12px; font-size: 11px; color: #666;">
                                 <i class="fas fa-users" style="margin-right: 5px;"></i>수용인원: ${restaurant.seatNum}명
                             </div>
                            <div style="border-top: 1px solid #eee; padding-top: 10px;">
                                <button onclick="openReservationModal('${restaurant.name}', '${restaurant.location}', ${restaurant.lat}, ${restaurant.lng})" 
                                        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 20px; font-size: 12px; cursor: pointer; width: 100%;">
                                    <i class="fas fa-calendar-plus" style="margin-right: 5px;"></i>
                                    예약하기
                                </button>
                            </div>
                        </div>
                    `
                });

                marker.addListener('click', () => {
                    infowindow.open(map, marker);
                });

                markers.push(marker);
            });
        }

        // 주변 레스토랑 목록 업데이트
        function updateNearbyRestaurantsList() {
            const container = document.getElementById('nearbyRestaurants');
            if (!container) return;

            container.innerHTML = restaurants.map(restaurant => `
                <div class="restaurant-item p-3 border-bottom" onclick="showRestaurantDetails('${restaurant.name}', '${restaurant.location}', ${restaurant.lat}, ${restaurant.lng}, ${restaurant.rating}, '${restaurant.cuisine}')">
                    <div class="restaurant-info">
                        <h6 class="restaurant-name mb-1">${restaurant.name}</h6>
                        <p class="restaurant-address text-muted small mb-1">${restaurant.location}</p>
                        <div class="restaurant-meta d-flex justify-content-between align-items-center">
                            <span class="rating text-warning">
                                <i class="fas fa-star"></i>
                                ${restaurant.rating.toFixed(1)}
                            </span>
                            <span class="cuisine-tag badge bg-secondary">${restaurant.cuisine}</span>
                        </div>
                        <div class="mt-2">
                            <small class="text-muted">
                                <i class="fas fa-users me-1"></i>수용인원: ${restaurant.seatNum}명
                            </small>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // 레스토랑 상세 정보 표시
        function showRestaurantDetails(restaurantName, location, lat, lng, rating, cuisine) {
            const restaurant = restaurants.find(r => r.name === restaurantName);
            if (restaurant) {
                openReservationModal(restaurantName, location, lat, lng, rating, cuisine);
            }
        }

        // 예약 모달 열기
        function openReservationModal(restaurantName, location, lat, lng, rating, cuisine) {
            // 해당 레스토랑 찾기
            const restaurant = restaurants.find(r => r.name === restaurantName);
            
            // 모달 내용 설정
            document.getElementById('modalRestaurantName').textContent = restaurantName;
            document.getElementById('modalRestaurantLocation').textContent = location;
            document.getElementById('modalRestaurantRating').textContent = `${rating.toFixed(1)}점`;
            document.getElementById('modalRestaurantCuisine').textContent = cuisine;
            
            // storeId 저장 (예약 시 사용)
            document.getElementById('reservationModal').setAttribute('data-store-id', restaurant ? restaurant.storeId : 'STORE001');

            // 오늘 날짜를 최소 날짜로 설정
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('reservationDate').min = today;
            document.getElementById('reservationDate').value = today;

            // 모달 열기
            const modal = new bootstrap.Modal(document.getElementById('reservationModal'));
            modal.show();
        }

        // 예약 제출
        function submitReservation() {
            // 로그인 상태 확인
            checkLoginStatus().then(isLoggedIn => {
                if (!isLoggedIn) {
                    alert('예약을 위해 로그인이 필요합니다.');
                    window.location.href = '/login-page';
                    return;
                }

                // 폼 데이터 수집
                const formData = {
                    restaurantName: document.getElementById('modalRestaurantName').textContent,
                    date: document.getElementById('reservationDate').value,
                    time: document.getElementById('reservationTime').value,
                    guests: document.getElementById('reservationGuests').value,
                    notes: document.getElementById('reservationNotes').value
                };

                // 유효성 검사
                if (!formData.date || !formData.time || !formData.guests) {
                    alert('모든 필수 항목을 입력해주세요.');
                    return;
                }

                // 예약 API 호출
                const storeId = document.getElementById('reservationModal').getAttribute('data-store-id') || 'STORE001';
                createReservation(formData, storeId);
            });
        }

        // 예약 생성 API 호출
        async function createReservation(reservationData, storeId) {
            try {
                const response = await fetch('/api/reservations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        storeId: storeId,
                        bookingDate: `${reservationData.date}T${reservationData.time}:00`,
                        count: parseInt(reservationData.guests),
                        notes: reservationData.notes
                    })
                });

                if (response.ok) {
                    alert('예약이 성공적으로 완료되었습니다!');
                    // 모달 닫기
                    const modal = bootstrap.Modal.getInstance(document.getElementById('reservationModal'));
                    modal.hide();
                    // 폼 초기화
                    document.getElementById('reservationForm').reset();
                } else {
                    const errorData = await response.json();
                    alert(`예약 실패: ${errorData.message || '알 수 없는 오류가 발생했습니다.'}`);
                }
            } catch (error) {
                console.error('예약 생성 중 오류:', error);
                alert('예약 생성 중 오류가 발생했습니다.');
            }
        }

        // API에서 레스토랑 데이터 로드
        function loadRestaurantsFromAPI() {
            console.log('API에서 레스토랑 데이터 로드 시작...');
            fetch('/api/restaurants')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`레스토랑 데이터를 불러오는데 실패했습니다. (${response.status})`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('API에서 받은 레스토랑 데이터:', data);
                    if (!Array.isArray(data) || data.length === 0) {
                        console.warn('API에서 빈 데이터를 받았습니다. 샘플 데이터를 사용합니다.');
                        loadSampleRestaurants();
                        return;
                    }
                    
                    // API 데이터를 지도용 형식으로 변환
                    restaurants = data.map((store, index) => ({
                        name: store.storeName,
                        location: store.storeLocation,
                        lat: 37.5172 + (Math.random() - 0.5) * 0.01, // 강남역 근처 랜덤 위치
                        lng: 127.0473 + (Math.random() - 0.5) * 0.01,
                        rating: 4.0 + Math.random() * 1.0, // 4.0-5.0 평점
                        cuisine: getCuisineFromStoreName(store.storeName),
                        seatNum: store.seatNum || 10,
                        storeId: store.storeId
                    }));
                    
                    console.log('변환된 레스토랑 데이터:', restaurants);
                    loadRestaurantsOnMap();
                    updateNearbyRestaurantsList();
                })
                .catch(error => {
                    console.error('API 오류:', error);
                    console.log('샘플 데이터로 폴백합니다.');
                    // 샘플 데이터로 폴백
                    loadSampleRestaurants();
                });
        }

        // 레스토랑 이름에서 음식 종류 추출
        function getCuisineFromStoreName(storeName) {
            if (storeName.includes('스테이크')) return '스테이크';
            if (storeName.includes('이탈리안')) return '이탈리안';
            if (storeName.includes('한식')) return '한식';
            if (storeName.includes('중식')) return '중식';
            if (storeName.includes('일식')) return '일식';
            if (storeName.includes('카페')) return '카페';
            return '기타';
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            // Google Maps API 로드 확인
            let retryCount = 0;
            const maxRetries = 3;
            
            function checkGoogleMaps() {
                if (typeof google !== 'undefined' && google.maps) {
                    console.log('Google Maps API 로드 완료');
                    return;
                }
                
                retryCount++;
                if (retryCount < maxRetries) {
                    console.log(`Google Maps API 로드 대기 중... (${retryCount}/${maxRetries})`);
                    setTimeout(checkGoogleMaps, 2000);
                } else {
                    console.log('Google Maps API 로드 실패, 오류 화면 표시');
                    showMapError();
                }
            }
            
            checkGoogleMaps();
            
            // 로그인 상태 확인 및 네비게이션 업데이트
            checkLoginStatus();
        });
        
        // 로그인 상태 확인
        async function checkLoginStatus() {
            try {
                const response = await fetch('/me');
                if (response.ok) {
                    const user = await response.json();
                    updateNavigationForLoggedInUser(user);
                    return true;
                } else {
                    // 401 오류는 정상적인 상황 (로그인되지 않은 상태)
                    console.log('로그인되지 않은 상태');
                    updateNavigationForGuest();
                    return false;
                }
            } catch (error) {
                console.error('로그인 상태 확인 실패:', error);
                updateNavigationForGuest();
                return false;
            }
        }
        
        // 로그인된 사용자를 위한 네비게이션
        function updateNavigationForLoggedInUser(user) {
            document.getElementById('loginLink').style.display = 'none';
            document.getElementById('signupLink').style.display = 'none';
            document.getElementById('mypageLink').style.display = 'inline-block';
            document.getElementById('logoutLink').style.display = 'inline-block';
            
            // 사용자 이름 표시 (선택사항)
            console.log('로그인된 사용자:', user.userName);
        }
        
        // 비로그인 사용자를 위한 네비게이션
        function updateNavigationForGuest() {
            document.getElementById('loginLink').style.display = 'inline-block';
            document.getElementById('signupLink').style.display = 'inline-block';
            document.getElementById('mypageLink').style.display = 'none';
            document.getElementById('logoutLink').style.display = 'none';
        }
    </script>
</body>
</html> 