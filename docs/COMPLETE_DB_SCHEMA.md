# 🗄️ Team-FOG 전체 데이터베이스 스키마

## 📋 개요

이 문서는 Team-FOG 프로젝트의 전체 데이터베이스 스키마를 정의합니다.
모든 테이블은 Oracle PDB (Pluggable Database) 환경에서 운영됩니다.

## 🏗️ 데이터베이스 구조

### Container Database (CDB)
- **CDB Name**: ORCL
- **PDB Name**: TEAMFOG

### 서비스별 스키마 분리
- **User Service**: user_service 스키마
- **Store Service**: store_service 스키마  
- **Reservation Service**: reservation_service 스키마

## 📊 테이블 정의

### 1. USERS 테이블 (User Service)
```sql
CREATE TABLE USERS (
    USER_ID VARCHAR2(15) PRIMARY KEY,
    USER_NAME VARCHAR2(20) NOT NULL,
    PHONE_NUMBER VARCHAR2(20) UNIQUE NOT NULL,
    USER_LOCATION VARCHAR2(50),
    PASSWORD VARCHAR2(255) NOT NULL,
    IS_ACTIVE NUMBER(1) DEFAULT 1 NOT NULL,
    CREATED_AT TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP
);

-- 인덱스
CREATE INDEX idx_users_phone ON USERS(PHONE_NUMBER);
```

### 2. FAV_STORE 테이블 (User Service)
```sql
CREATE TABLE FAV_STORE (
    FAV_STORE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USER_ID VARCHAR2(15) NOT NULL,
    STORE_ID2 VARCHAR2(20) NOT NULL,
    CREATED_AT TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL,
    CONSTRAINT fav_store_un UNIQUE (USER_ID, STORE_ID2)
);

-- 인덱스
CREATE INDEX idx_fav_store_user ON FAV_STORE(USER_ID);
CREATE INDEX idx_fav_store_store ON FAV_STORE(STORE_ID2);
```

### 3. STORES 테이블 (Store Service)
```sql
CREATE TABLE STORES (
    STORE_ID VARCHAR2(20) PRIMARY KEY,
    STORE_NAME VARCHAR2(100) NOT NULL,
    STORE_LOCATION VARCHAR2(200) NOT NULL,
    SERVICE_TIME VARCHAR2(100),
    CATEGORY_CODE VARCHAR2(10) NOT NULL,
    SEAT_NUM NUMBER NOT NULL
);

-- 인덱스
CREATE INDEX idx_stores_category ON STORES(CATEGORY_CODE);
```

### 4. MENU 테이블 (Store Service)
```sql
CREATE TABLE MENU (
    STORE_ID VARCHAR2(20) NOT NULL,
    FIELD VARCHAR2(100) NOT NULL,
    PRICE NUMBER NOT NULL,
    CONSTRAINT pk_menu PRIMARY KEY (STORE_ID, FIELD)
);

-- 인덱스
CREATE INDEX idx_menu_store ON MENU(STORE_ID);
```

### 5. BOOKING 테이블 (Reservation Service)
```sql
CREATE TABLE BOOKING (
    BOOKING_NUM VARCHAR2(20) PRIMARY KEY,
    BOOKING_DATE DATE NOT NULL,
    USER_ID VARCHAR2(15) NOT NULL,
    STORE_ID VARCHAR2(20) NOT NULL,
    BOOKING_STATE_CODE VARCHAR2(10) NOT NULL,
    COUNT NUMBER NOT NULL
);

-- 인덱스
CREATE INDEX idx_booking_user ON BOOKING(USER_ID);
CREATE INDEX idx_booking_store ON BOOKING(STORE_ID);
CREATE INDEX idx_booking_date ON BOOKING(BOOKING_DATE);
```

### 6. STORE_SEAT 테이블 (Reservation Service)
```sql
CREATE TABLE STORE_SEAT (
    STORE_ID VARCHAR2(20) PRIMARY KEY,
    IN_USING_SEAT NUMBER NOT NULL
);
```

### 7. REVIEW 테이블 (Store Service)
```sql
CREATE TABLE REVIEW (
    REVIEW_ID VARCHAR2(20) PRIMARY KEY,
    STORE_ID VARCHAR2(20) NOT NULL,
    USER_ID VARCHAR2(15) NOT NULL,
    COMMENT CLOB,
    SCORE NUMBER(2,1) CHECK (SCORE >= 1 AND SCORE <= 10)
);

-- 인덱스
CREATE INDEX idx_review_store ON REVIEW(STORE_ID);
CREATE INDEX idx_review_user ON REVIEW(USER_ID);
```

### 8. BOOKING_STATE_CODE 테이블 (Reservation Service)
```sql
CREATE TABLE BOOKING_STATE_CODE (
    BOOKING_STATE_CODE VARCHAR2(10) PRIMARY KEY,
    STATE_NAME VARCHAR2(50) NOT NULL
);

-- 기본 데이터
INSERT INTO BOOKING_STATE_CODE VALUES ('RESERVED', '예약');
INSERT INTO BOOKING_STATE_CODE VALUES ('IN_PROGRESS', '예약 중');
INSERT INTO BOOKING_STATE_CODE VALUES ('CANCELLED', '예약 취소');
```

### 9. CATEGORY 테이블 (Store Service)
```sql
CREATE TABLE CATEGORY (
    CATEGORY_CODE VARCHAR2(10) PRIMARY KEY,
    CATEGORY_NAME VARCHAR2(50) NOT NULL
);

-- 기본 데이터
INSERT INTO CATEGORY VALUES ('KOREAN', '한식');
INSERT INTO CATEGORY VALUES ('CHINESE', '중식');
INSERT INTO CATEGORY VALUES ('JAPANESE', '일식');
INSERT INTO CATEGORY VALUES ('WESTERN', '양식');
INSERT INTO CATEGORY VALUES ('CAFE', '카페');
```

## 🔗 외래키 제약조건

```sql
-- FAV_STORE 테이블 외래키
ALTER TABLE FAV_STORE ADD CONSTRAINT fk_fav_store_user 
    FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID);

ALTER TABLE FAV_STORE ADD CONSTRAINT fk_fav_store_store 
    FOREIGN KEY (STORE_ID2) REFERENCES STORES(STORE_ID);

-- MENU 테이블 외래키
ALTER TABLE MENU ADD CONSTRAINT fk_menu_store 
    FOREIGN KEY (STORE_ID) REFERENCES STORES(STORE_ID);

-- BOOKING 테이블 외래키
ALTER TABLE BOOKING ADD CONSTRAINT fk_booking_user 
    FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID);

ALTER TABLE BOOKING ADD CONSTRAINT fk_booking_store 
    FOREIGN KEY (STORE_ID) REFERENCES STORES(STORE_ID);

ALTER TABLE BOOKING ADD CONSTRAINT fk_booking_state 
    FOREIGN KEY (BOOKING_STATE_CODE) REFERENCES BOOKING_STATE_CODE(BOOKING_STATE_CODE);

-- STORE_SEAT 테이블 외래키
ALTER TABLE STORE_SEAT ADD CONSTRAINT fk_store_seat_store 
    FOREIGN KEY (STORE_ID) REFERENCES STORES(STORE_ID);

-- REVIEW 테이블 외래키
ALTER TABLE REVIEW ADD CONSTRAINT fk_review_store 
    FOREIGN KEY (STORE_ID) REFERENCES STORES(STORE_ID);

ALTER TABLE REVIEW ADD CONSTRAINT fk_review_user 
    FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID);

-- STORES 테이블 외래키
ALTER TABLE STORES ADD CONSTRAINT fk_stores_category 
    FOREIGN KEY (CATEGORY_CODE) REFERENCES CATEGORY(CATEGORY_CODE);
```

## 📝 서비스별 테이블 분담

### User Service 담당
- USERS
- FAV_STORE

### Store Service 담당
- STORES
- MENU
- REVIEW
- CATEGORY

### Reservation Service 담당
- BOOKING
- STORE_SEAT
- BOOKING_STATE_CODE

## 🔧 Oracle PDB 설정

### PDB 생성 및 설정
```sql
-- PDB 생성
CREATE PLUGGABLE DATABASE TEAMFOG
ADMIN USER teamfog_admin IDENTIFIED BY "admin_password_here"
STORAGE (MAXSIZE 2G)
DEFAULT TABLESPACE teamfog_data
DATAFILE '/opt/oracle/oradata/ORCL/TEAMFOG/teamfog_data01.dbf' SIZE 100M
AUTOEXTEND ON NEXT 10M MAXSIZE 1G;

-- PDB 열기
ALTER PLUGGABLE DATABASE TEAMFOG OPEN;

-- PDB로 전환
ALTER SESSION SET CONTAINER = TEAMFOG;
```

### 서비스별 사용자 생성
```sql
-- User Service 사용자
CREATE USER user_service IDENTIFIED BY "user_password_here";
GRANT CONNECT, RESOURCE TO user_service;
GRANT CREATE SESSION TO user_service;
GRANT CREATE TABLE TO user_service;
GRANT CREATE VIEW TO user_service;
GRANT CREATE SEQUENCE TO user_service;

-- Store Service 사용자
CREATE USER store_service IDENTIFIED BY "store_password_here";
GRANT CONNECT, RESOURCE TO store_service;
GRANT CREATE SESSION TO store_service;
GRANT CREATE TABLE TO store_service;
GRANT CREATE VIEW TO store_service;
GRANT CREATE SEQUENCE TO store_service;

-- Reservation Service 사용자
CREATE USER reservation_service IDENTIFIED BY "reservation_password_here";
GRANT CONNECT, RESOURCE TO reservation_service;
GRANT CREATE SESSION TO reservation_service;
GRANT CREATE TABLE TO reservation_service;
GRANT CREATE VIEW TO reservation_service;
GRANT CREATE SEQUENCE TO reservation_service;
```

## 📊 데이터 타입 매핑

| Logical | Physical | Oracle Type | Java Type |
|---------|----------|-------------|-----------|
| 유저ID | USER_ID | VARCHAR2(15) | String |
| 유저이름 | USER_NAME | VARCHAR2(20) | String |
| 핸드폰번호 | PHONE_NUMBER | VARCHAR2(20) | String |
| 주소지 | USER_LOCATION | VARCHAR2(50) | String |
| 비밀번호 | PASSWORD | VARCHAR2(255) | String |
| 가게ID | STORE_ID | VARCHAR2(20) | String |
| 가게이름 | STORE_NAME | VARCHAR2(100) | String |
| 가게주소 | STORE_LOCATION | VARCHAR2(200) | String |
| 예약번호 | BOOKING_NUM | VARCHAR2(20) | String |
| 예약일자 | BOOKING_DATE | DATE | LocalDate |
| 인원수 | COUNT | NUMBER | Integer |
| 평점 | SCORE | NUMBER(2,1) | Double |
| 가격 | PRICE | NUMBER | BigDecimal |

## 🚀 배포 시 주의사항

1. **테이블 생성 순서**: 외래키 제약조건을 고려하여 올바른 순서로 생성
2. **인덱스 생성**: 성능 최적화를 위해 적절한 인덱스 생성
3. **권한 설정**: 각 서비스별로 필요한 최소 권한만 부여
4. **데이터 백업**: 정기적인 데이터 백업 설정
5. **모니터링**: 테이블 크기 및 성능 모니터링 설정
