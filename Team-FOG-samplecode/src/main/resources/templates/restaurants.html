<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>레스토랑 목록 - 전국 레스토랑 예약 시스템</title>
    
    <!-- Bootstrap 5.3.0 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --light-bg: #f8f9fa;
            --dark-bg: #2c3e50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            line-height: 1.6;
            color: var(--primary-color);
        }
        
        /* Navigation */
        .navbar {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
        }
        
        .nav-link {
            color: white !important;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover {
            color: var(--warning-color) !important;
            transform: translateY(-2px);
        }
        
        /* Page Header */
        .page-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 40px 0;
            text-align: center;
        }
        
        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        /* Restaurant Cards */
        .restaurant-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            margin-bottom: 30px;
            cursor: pointer;
        }
        
        .restaurant-card:hover {
            transform: translateY(-5px);
        }
        
        .restaurant-image {
            height: 200px;
            background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
        }
        
        .restaurant-info {
            padding: 20px;
        }
        
        .restaurant-name {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }
        
        .restaurant-location {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .restaurant-rating {
            color: var(--warning-color);
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .restaurant-status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .status-open {
            background: var(--success-color);
            color: white;
        }
        
        .status-closed {
            background: var(--accent-color);
            color: white;
        }
        
        /* Search */
        .search-section {
            background: var(--light-bg);
            padding: 30px 0;
        }
        
        .search-box {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .form-control {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            padding: 12px 15px;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        }
        
        .btn-primary {
            background: var(--secondary-color);
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: var(--primary-color);
            transform: translateY(-2px);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .page-title {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-utensils me-2"></i>전국 레스토랑 예약
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/"><i class="fas fa-home me-1"></i>홈</a>
                    </li>
                    <li class="nav-item" id="reservationsLink" style="display: none;">
                        <a class="nav-link" href="/reservations"><i class="fas fa-calendar me-1"></i>예약 관리</a>
                    </li>
                    <li class="nav-item" id="mypageLink" style="display: none;">
                        <a class="nav-link" href="/mypage"><i class="fas fa-user me-1"></i>마이페이지</a>
                    </li>
                    <li class="nav-item" id="loginLink">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#loginModal">
                            <i class="fas fa-sign-in-alt me-1"></i>로그인
                        </a>
                    </li>
                    <li class="nav-item" id="logoutLink" style="display: none;">
                        <a class="nav-link" href="#" onclick="logout()">
                            <i class="fas fa-sign-out-alt me-1"></i>로그아웃
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1 class="page-title">
                <i class="fas fa-utensils me-2"></i>레스토랑 목록
            </h1>
            <p>전국의 맛있는 레스토랑을 찾아보세요</p>
        </div>
    </section>

    <!-- Search Section -->
    <section class="search-section">
        <div class="container">
            <div class="search-box">
                <div class="row">
                    <div class="col-md-8">
                        <div class="input-group">
                            <input type="text" class="form-control" id="searchInput" placeholder="레스토랑명 또는 위치로 검색...">
                            <button class="btn btn-primary" type="button" onclick="searchRestaurants()">
                                <i class="fas fa-search me-1"></i>검색
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <select class="form-control" id="categoryFilter">
                            <option value="">모든 카테고리</option>
                            <option value="1">한식</option>
                            <option value="2">양식</option>
                            <option value="3">일식</option>
                            <option value="4">중식</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Restaurant List -->
    <section class="py-5">
        <div class="container">
            <div class="row" id="restaurantList">
                <!-- 레스토랑 카드들이 여기에 동적으로 로드됩니다 -->
            </div>
        </div>
    </section>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        let restaurants = [];
        let isLoggedIn = false;
        let currentUser = null;

        // 페이지 로드 시 실행
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            loadRestaurants();
        });

        // 로그인 상태 확인
        async function checkLoginStatus() {
            try {
                const response = await fetch('/login/status');
                if (response.ok) {
                    const data = await response.json();
                    if (data.loggedIn) {
                        currentUser = data;
                        isLoggedIn = true;
                        updateNavigation();
                    } else {
                        isLoggedIn = false;
                        updateNavigation();
                    }
                } else {
                    isLoggedIn = false;
                    updateNavigation();
                }
            } catch (error) {
                console.error('로그인 상태 확인 오류:', error);
                isLoggedIn = false;
                updateNavigation();
            }
        }

        // 네비게이션 업데이트
        function updateNavigation() {
            const loginLink = document.getElementById('loginLink');
            const logoutLink = document.getElementById('logoutLink');
            const reservationsLink = document.getElementById('reservationsLink');
            const mypageLink = document.getElementById('mypageLink');

            if (isLoggedIn) {
                loginLink.style.display = 'none';
                logoutLink.style.display = 'block';
                reservationsLink.style.display = 'block';
                mypageLink.style.display = 'block';
            } else {
                loginLink.style.display = 'block';
                logoutLink.style.display = 'none';
                reservationsLink.style.display = 'none';
                mypageLink.style.display = 'none';
            }
        }

        // 레스토랑 데이터 로드
        function loadRestaurants() {
            // 더미 데이터 (실제로는 Store Service API 호출)
            restaurants = [
                {
                    storeId: 'STORE001',
                    storeName: '맛있는 한정식',
                    storeLocation: '서울시 강남구 역삼동',
                    categoryCode: 1,
                    seatNum: 20,
                    inUsingSeat: 15,
                    serviceTime: new Date('2024-01-15T12:00:00'),
                    score: 4.5
                },
                {
                    storeId: 'STORE002',
                    storeName: '이탈리안 파스타',
                    storeLocation: '서울시 강남구 삼성동',
                    categoryCode: 2,
                    seatNum: 15,
                    inUsingSeat: 12,
                    serviceTime: new Date('2024-01-15T12:30:00'),
                    score: 4.2
                },
                {
                    storeId: 'STORE003',
                    storeName: '프리미엄 스시',
                    storeLocation: '서울시 강남구 청담동',
                    categoryCode: 3,
                    seatNum: 12,
                    inUsingSeat: 8,
                    serviceTime: new Date('2024-01-15T13:00:00'),
                    score: 4.8
                },
                {
                    storeId: 'STORE004',
                    storeName: '중국 요리',
                    storeLocation: '서울시 강남구 논현동',
                    categoryCode: 4,
                    seatNum: 25,
                    inUsingSeat: 20,
                    serviceTime: new Date('2024-01-15T12:15:00'),
                    score: 4.0
                },
                {
                    storeId: 'STORE005',
                    storeName: '스테이크 하우스',
                    storeLocation: '서울시 강남구 압구정동',
                    categoryCode: 2,
                    seatNum: 18,
                    inUsingSeat: 14,
                    serviceTime: new Date('2024-01-15T13:30:00'),
                    score: 4.3
                }
            ];
            
            displayRestaurants();
        }

        // 레스토랑 목록 표시
        function displayRestaurants() {
            const container = document.getElementById('restaurantList');
            container.innerHTML = '';

            restaurants.forEach(restaurant => {
                const card = document.createElement('div');
                card.className = 'col-lg-4 col-md-6';
                
                const categoryText = getCategoryName(restaurant.categoryCode);
                const availableSeats = restaurant.seatNum - restaurant.inUsingSeat;
                
                card.innerHTML = `
                    <div class="restaurant-card" onclick="openReservationModal('${restaurant.storeId}')">
                        <div class="restaurant-image">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div class="restaurant-info">
                            <h5 class="restaurant-name">${restaurant.storeName}</h5>
                            <p class="restaurant-location">
                                <i class="fas fa-map-marker-alt me-1"></i>${restaurant.storeLocation}
                            </p>
                            <div class="restaurant-rating">
                                <i class="fas fa-star me-1"></i>${restaurant.score}
                            </div>
                            <div class="restaurant-status ${isOpenNow(restaurant.serviceTime) ? 'status-open' : 'status-closed'}">
                                ${isOpenNow(restaurant.serviceTime) ? '영업중' : '영업종료'}
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">
                                    <i class="fas fa-chair me-1"></i>${availableSeats}/${restaurant.seatNum}석
                                </small>
                                <small class="text-muted">
                                    <i class="fas fa-utensils me-1"></i>${categoryText}
                                </small>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // 카테고리 이름 가져오기
        function getCategoryName(categoryCode) {
            const categories = {
                1: '한식',
                2: '양식',
                3: '일식',
                4: '중식',
                5: '분식',
                6: '카페',
                7: '디저트',
                8: '주점'
            };
            return categories[categoryCode] || '기타';
        }

        // 영업중인지 판단
        function isOpenNow(serviceTime) {
            if (!serviceTime) return false;
            
            const now = new Date();
            const serviceDate = new Date(serviceTime);
            
            // serviceTime이 오늘 날짜인지 확인
            const today = new Date();
            const isToday = serviceDate.getDate() === today.getDate() &&
                           serviceDate.getMonth() === today.getMonth() &&
                           serviceDate.getFullYear() === today.getFullYear();
            
            if (!isToday) return false;
            
            // 현재 시간과 serviceTime 비교
            const currentHour = now.getHours();
            const serviceHour = serviceDate.getHours();
            
            // serviceTime 기준으로 2시간 동안 영업한다고 가정
            const openHour = serviceHour;
            const closeHour = serviceHour + 2;
            
            return currentHour >= openHour && currentHour < closeHour;
        }

        // 검색 기능
        function searchRestaurants() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            
            const filteredRestaurants = restaurants.filter(restaurant => {
                const matchesSearch = restaurant.storeName.toLowerCase().includes(searchTerm) ||
                                    restaurant.storeLocation.toLowerCase().includes(searchTerm);
                const matchesCategory = !categoryFilter || restaurant.categoryCode.toString() === categoryFilter;
                
                return matchesSearch && matchesCategory;
            });
            
            displayFilteredRestaurants(filteredRestaurants);
        }

        // 필터링된 레스토랑 표시
        function displayFilteredRestaurants(filteredRestaurants) {
            const container = document.getElementById('restaurantList');
            container.innerHTML = '';

            if (filteredRestaurants.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center">
                        <div class="alert alert-info">
                            <i class="fas fa-search me-2"></i>
                            검색 결과가 없습니다.
                        </div>
                    </div>
                `;
                return;
            }

            filteredRestaurants.forEach(restaurant => {
                const card = document.createElement('div');
                card.className = 'col-lg-4 col-md-6';
                
                const categoryText = getCategoryName(restaurant.categoryCode);
                const availableSeats = restaurant.seatNum - restaurant.inUsingSeat;
                
                card.innerHTML = `
                    <div class="restaurant-card" onclick="openReservationModal('${restaurant.storeId}')">
                        <div class="restaurant-image">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div class="restaurant-info">
                            <h5 class="restaurant-name">${restaurant.storeName}</h5>
                            <p class="restaurant-location">
                                <i class="fas fa-map-marker-alt me-1"></i>${restaurant.storeLocation}
                            </p>
                            <div class="restaurant-rating">
                                <i class="fas fa-star me-1"></i>${restaurant.score}
                            </div>
                            <div class="restaurant-status ${isOpenNow(restaurant.serviceTime) ? 'status-open' : 'status-closed'}">
                                ${isOpenNow(restaurant.serviceTime) ? '영업중' : '영업종료'}
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">
                                    <i class="fas fa-chair me-1"></i>${availableSeats}/${restaurant.seatNum}석
                                </small>
                                <small class="text-muted">
                                    <i class="fas fa-utensils me-1"></i>${categoryText}
                                </small>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // 예약 모달 열기
        function openReservationModal(storeId) {
            if (!isLoggedIn) {
                alert('예약을 하려면 로그인이 필요합니다.');
                return;
            }

            const restaurant = restaurants.find(r => r.storeId === storeId);
            if (restaurant) {
                alert(`예약 기능은 Booking Service에서 처리됩니다.\n선택한 가게: ${restaurant.storeName}`);
            }
        }

        // 로그아웃
        async function logout() {
            try {
                const response = await fetch('/login/logout', {
                    method: 'POST'
                });

                if (response.ok) {
                    isLoggedIn = false;
                    currentUser = null;
                    updateNavigation();
                    alert('로그아웃되었습니다.');
                    window.location.href = '/';
                }
            } catch (error) {
                console.error('로그아웃 오류:', error);
                alert('로그아웃 중 오류가 발생했습니다.');
            }
        }
    </script>
</body>
</html> 