CREATE TABLE BOOKING 
    ( 
     BOOKING_NUM        INTEGER  NOT NULL , 
     BOOKING_DATE       DATE  NOT NULL , 
     USER_ID            VARCHAR2 (15)  NOT NULL , 
     STORE_ID           VARCHAR2 (20)  NOT NULL , 
     BOOKING_STATE_CODE INTEGER  NOT NULL , 
     COUNT              INTEGER  NOT NULL 
    ) 
;

ALTER TABLE BOOKING 
    ADD CONSTRAINT BOOKING_PK PRIMARY KEY ( BOOKING_NUM ) ;

ALTER TABLE BOOKING 
    ADD CONSTRAINT BOOKING_BOOKING_STATE_CODE_FK FOREIGN KEY 
    ( 
     BOOKING_STATE_CODE
    ) 
    REFERENCES BOOKING_STATE_CODE 
    ( 
     BOOKING_STATE_CODE
    ) 
;

ALTER TABLE BOOKING 
    ADD CONSTRAINT BOOKING_STORES_VIEW_FK FOREIGN KEY 
    ( 
     STORE_ID
    ) 
    REFERENCES STORES_VIEW 
    ( 
     STORE_ID
    ) 
;

ALTER TABLE BOOKING 
    ADD CONSTRAINT BOOKING_USERS_VIEW_FK FOREIGN KEY 
    ( 
     USER_ID
    ) 
    REFERENCES USERS_VIEW 
    ( 
     USER_ID
    ) 
;

CREATE SEQUENCE BOOKING_BOOKING_NUM_SEQ 
START WITH 1 
    NOCACHE 
    ORDER ;

CREATE OR REPLACE TRIGGER BOOKING_BOOKING_NUM_TRG 
BEFORE INSERT ON BOOKING 
FOR EACH ROW 
WHEN (NEW.BOOKING_NUM IS NULL) 
BEGIN 
    :NEW.BOOKING_NUM := BOOKING_BOOKING_NUM_SEQ.NEXTVAL; 
END;
/


---------------------------------------------------------------------

CREATE TABLE BOOKING_STATE_CODE 
    ( 
     BOOKING_STATE_CODE INTEGER  NOT NULL , 
     STATE_NAME         VARCHAR2 (10)  NOT NULL 
    ) 
;

ALTER TABLE BOOKING_STATE_CODE 
    ADD CONSTRAINT BOOKING_STATE_CODE_PK PRIMARY KEY ( BOOKING_STATE_CODE ) ;

------------------------------------------------------------------------------

CREATE TABLE STORES_VIEW 
    ( 
     STORE_ID       VARCHAR2 (20 CHAR)  NOT NULL , 
     STORE_NAME     VARCHAR2 (50 CHAR)  NOT NULL , 
     CARTEGORY_CODE INTEGER  NOT NULL , 
     MENU_ID        INTEGER  NOT NULL , 
     LOCATION       VARCHAR2 (50 CHAR)  NOT NULL , 
     SEAT_NUM       INTEGER DEFAULT 5  NOT NULL , 
     INUSING_SEAT   INTEGER , 
     SERVICE_TIME   DATE 
    ) 
;

ALTER TABLE STORES_VIEW 
    ADD CONSTRAINT STORES_PK PRIMARY KEY ( STORE_ID ) ;


----------------------------------------------------------------------------------

CREATE TABLE USERS_VIEW 
    ( 
     USER_ID      VARCHAR2 (15 CHAR)  NOT NULL , 
     USER_NAME    VARCHAR2 (20 CHAR)  NOT NULL , 
     LOCATION     VARCHAR2 (50 CHAR) , 
     PHONE_NUMBER VARCHAR2 (20 CHAR)  NOT NULL 
    ) 
;

ALTER TABLE USERS_VIEW 
    ADD CONSTRAINT USERS_PK PRIMARY KEY ( USER_ID ) ;



